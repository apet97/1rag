{"rank":1,"category":"correctness","subcategory":"module_imports","issue":"clockify_rag package modules miss required imports, breaking package usage","impact":"HIGH","effort":"MEDIUM","file":"clockify_rag/embedding.py","line":1,"current":"import os\n\nimport numpy as np","proposed":"Add missing imports (logging, json, requests, hashlib, atexit, platform, tempfile, re) across package modules","rationale":"Refactor introduced separate package but omitted critical imports, so any consumer of clockify_rag.* fails immediately","implementation":"Audit each module, add explicit imports, run static analysis to ensure no NameError at import time","expected_gain":"Restores usable modular API for downstream integrations","references":["clockify_rag/embedding.py","clockify_rag/http_utils.py","clockify_rag/utils.py"]}
{"rank":2,"category":"architecture","subcategory":"deduplication","issue":"QueryCache and RateLimiter redefined in CLI despite importing from clockify_rag.caching","impact":"HIGH","effort":"MEDIUM","file":"clockify_support_cli_final.py","line":2164,"current":"class RateLimiter: ... class QueryCache: ...","proposed":"Use implementations from clockify_rag.caching or move canonical versions into shared module","rationale":"Duplicated logic risks divergent behavior (e.g., metadata timestamps) and blocks reuse","implementation":"Remove local class definitions, import from package, update tests to target shared implementations","expected_gain":"Single source of truth for caching/rate limiting with lower maintenance cost","references":["clockify_support_cli_final.py","clockify_rag/caching.py"]}
{"rank":3,"category":"security","subcategory":"logging","issue":"Query logging in CLI ignores LOG_QUERY_INCLUDE_ANSWER and placeholder flags","impact":"HIGH","effort":"LOW","file":"clockify_support_cli_final.py","line":2388,"current":"log_entry = {..., 'answer': answer,...}","proposed":"Honor config flags from clockify_rag.config when writing query logs","rationale":"Sensitive answers may leak when logging should redact or omit content","implementation":"Read LOG_QUERY_INCLUDE_ANSWER and LOG_QUERY_ANSWER_PLACEHOLDER before adding answer to log entry","expected_gain":"Prevents unintended disclosure of user and knowledge base content","references":["clockify_support_cli_final.py","clockify_rag/config.py"]}
{"rank":4,"category":"RAG","subcategory":"evaluation","issue":"eval.py lacks quantitative metrics (MRR/NDCG) for retrieval quality","impact":"HIGH","effort":"MEDIUM","file":"eval.py","line":1,"current":"Manual answer comparison helpers","proposed":"Compute ranking metrics over eval_dataset.jsonl and emit JSON/CSV results","rationale":"Without metrics, regressions in retrieval quality go undetected","implementation":"For each query, compare ranked citations to ground truth and compute MRR/NDCG/Recall; integrate with CI","expected_gain":"Provides repeatable evidence of retrieval improvements or regressions","references":["eval.py","eval_dataset.jsonl"]}
{"rank":5,"category":"performance","subcategory":"embedding","issue":"Embedding batch size inconsistent between CLI (96) and package (32)","impact":"MEDIUM","effort":"LOW","file":"clockify_rag/embedding.py","line":11,"current":"_ST_BATCH_SIZE = 32","proposed":"Raise batch size to 96 (configurable) to match optimized CLI","rationale":"Smaller default increases latency and contradicts tuning notes","implementation":"Expose batch size constant in config, reuse in both package and CLI","expected_gain":"~2-3x faster local embedding throughput","references":["clockify_rag/embedding.py","clockify_support_cli_final.py"]}
{"rank":6,"category":"architecture","subcategory":"modularization","issue":"Shared retrieval utilities exist only in monolithic CLI","impact":"HIGH","effort":"HIGH","file":"clockify_support_cli_final.py","line":1400,"current":"Hybrid retrieval, rerank, packing implemented inline","proposed":"Extract retrieval pipeline into reusable clockify_rag.retrieval module","rationale":"Consumers outside CLI cannot reuse retrieval stack; duplication fosters bugs","implementation":"Move retrieve/pack/rerank helpers into package, update CLI to import them, adjust tests","expected_gain":"Reusable service/core library and easier maintenance","references":["clockify_support_cli_final.py","clockify_rag/indexing.py"]}
{"rank":7,"category":"security","subcategory":"repository","issue":"Binary archive deepseek-v4.0-evidence.tar.gz stored in repo","impact":"MEDIUM","effort":"LOW","file":"deepseek-v4.0-evidence.tar.gz","line":1,"current":"Binary artifact committed","proposed":"Remove archive and rely on external storage or generated evidence","rationale":"Large binaries bloat repo and may contain sensitive data","implementation":"Delete file, purge from history if possible, document retrieval procedure","expected_gain":"Smaller repo and reduced leakage risk","references":["deepseek-v4.0-evidence.tar.gz"]}
{"rank":8,"category":"testing","subcategory":"coverage","issue":"No tests import clockify_rag package modules directly","impact":"HIGH","effort":"MEDIUM","file":"tests","line":1,"current":"Tests exercise CLI functions","proposed":"Add tests that import and use clockify_rag utilities to prevent regressions","rationale":"Package currently unusable without tests failing","implementation":"Create unit tests for chunking, embedding, caching via package API","expected_gain":"Ensures modular API remains functional","references":["tests/test_chunker.py","clockify_rag/__init__.py"]}
{"rank":9,"category":"RAG","subcategory":"logging","issue":"Retrieval profiling metrics not surfaced to users","impact":"MEDIUM","effort":"LOW","file":"benchmark.py","line":160,"current":"aggregate_retrieval_profiles computed but unused","proposed":"Emit profiling summary in CLI debug output and benchmark reports","rationale":"Developers lack visibility into ANN savings and dense compute reuse","implementation":"Return aggregated stats from retrieve() and log in answer_once + benchmark","expected_gain":"Better performance tuning insight","references":["clockify_support_cli_final.py","benchmark.py"]}
{"rank":10,"category":"DX","subcategory":"documentation","issue":"Documentation set fragmented across dozens of legacy files","impact":"MEDIUM","effort":"HIGH","file":"README.md","line":1,"current":"Multiple overlapping guides","proposed":"Consolidate into single authoritative docs (README + docs/ site)","rationale":"Developers struggle to find accurate setup info","implementation":"Audit docs, merge current instructions, deprecate archived files","expected_gain":"Faster onboarding and lower risk of following stale guides","references":["README.md","PROJECT_STRUCTURE.md"]}
